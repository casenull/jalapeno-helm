{{- $files := .Files.Glob "files/dashboards/*.json" -}}
{{- if $files }}
{{- range $path, $bytes := $files }}
{{- $base := base $path -}}
{{- $name := (trimSuffix ".json" $base) | lower | replace "_" "-" | replace "." "-" | trunc 63 | trimSuffix "-" }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-{{- $name }}
  labels:
    grafana-dashboard: "true"
data:
  dashboard.json: |-
{{ $.Files.Get $path | indent 4 }}
---
{{- end }}
{{- end }}

